<?xml version="1.0"?>
<project name="Approdictio" default="compile" basedir=".">

  <property name="version" value="0.9"/>
  <taskdef resource="ant-grobocoverage.properties"/>

  <target name="compile"
    description="compiles java classes">
    <mkdir dir="Classes"/>
    <javac srcdir="."
      destdir="Classes"
      source="1.5"
      listfiles="no"
      fork="false"
      debug="true"
      deprecation="true"
      >
      <compilerarg value="-Xlint:unchecked"/>
      <patternset includes="src/java/**/*.java" />
    </javac>
  </target>

  <target name="javadoc" description="run javadoc to create api docs">
    <javadoc sourcepath="src/java"
      packagenames="*"
      destdir="Approdictio-api"
      windowtitle="Approximate Lookup Dictionaries"
      header="&lt;span style='color:red'&gt;Approdictio&lt;/span&gt;"
      footer="&lt;a href='http://approdictio.berlios.de/'&gt;approdictio.berlios.de&lt;/a&gt;"
      overview="src/java/overview.html"
      stylesheetfile="files/stylesheet.css"
      >
    </javadoc>
  </target> 
  
  <target name="jar">
    <mkdir dir="dist"/>
    <jar destfile="dist/Approdictio-${version}.jar" basedir="Classes"
      includes="**/*.class">
      <manifest>
	<attribute name="version" value="${version}" />
      </manifest>
    </jar>
  </target>

  <target name="docjar" depends="javadoc">
    <mkdir dir="dist"/>
    <jar destfile="dist/Approdictio-doc-${version}.jar"
      basedir="." includes="Approdictio-api/**">
      <manifest>
	<attribute name="version" value="${version}" />
      </manifest>
    </jar>
  </target>

  <target name="compiletests"
    description="compiles java test classes">
    <javac srcdir="."
      destdir="Classes"
      source="1.5"
      listfiles="no"
      fork="false"
      debug="true"
      deprecation="true"
      >
      <compilerarg value="-Xlint:unchecked"/>
      <patternset includes="testsrc/**/*.java" />
    </javac>
  </target>

  <target name="grobo" depends="compile, compiletests">
    <mkdir dir="coverage"/>
    <grobo-instrument logdir="coverage/logs" logger="fast"
      destdir="coverage/Classes">
      <fileset dir="Classes">
	<exclude name="**/Test*.class"/>
      </fileset>
      <measure type="linecount" />
      <measure type="function" />
    </grobo-instrument>
  </target>


  <target name="unitest" depends="compile, compiletests, grobo"
    description="run unit test with junit4">

    <junit printsummary="withOutAndErr">
      <classpath>
	<pathelement location="coverage/Classes"/>
	<pathelement location="Classes"/>
      </classpath>
      <formatter type="plain" usefile="false"/>
      <test name="dict.TestDictionary"/>
      <test name="levenshtein.TestLevenshtein"/>
    </junit>
  </target>

  <target name="coverage" depends="unitest">
    <grobo-report logdir="coverage/logs">
      <simple destdir="coverage" removeempty="true" />
      <source destdir="coverage/source-report" removeempty="true"
	srcdir="src/java" title="Coverage Report of Approdictio" />
    </grobo-report>
  </target>


  <target name="e">
    <echoproperties/>
  </target>
</project>